# Walkthrough - 完璧なる音響の洗練（BGM遷移と堅牢化）

## 概要
本フェーズでは、メニュー画面からゲーム本編へのオーディオの連続性を極限まで高め、遷移時の安定性を向上させる「Keep-Alive」ロジックを実装しました。

## Phase 11: 音楽の連続性と没入感（BGM遷移の洗練）

### 1. メニュー全般でのBGM持続（堅牢性の向上）
- **Keep-Aliveロジック**: 設定画面やランキング画面の初期化時（`initState`）に、BGMの状態を再確認して維持する処理を追加しました。これにより、ナビゲーション時の予期せぬ停止を防ぎ、没入感を維持します。
- **デバッグログの統合**: `AudioController` にBGMの再生状態、ファイル名、既存状態のチェックログを追加しました。これにより、万が一音楽が止まった場合でも原因の特定が容易になります。

### 2. 精緻な切り替えポイントの実装
- **ゲーム開始の瞬間**: 難易度決定後、実際にパズル画面（GameScreen）が表示された瞬間に、音楽が静寂と集中のアンビエント（`main_bgm.mp3`）へと切り替わります。
- **シームレスな復帰**: ゲームを中断、またはクリアしてタイトルに戻った際、即座にタイトルBGMが再開されるようにナビゲーション処理を強化しました。

## Phase 15: 煽り全開！「ズームアップ・タウント」演出

### 1. 「ビビってやめる」ボタンの実装
- **逃げる者への挑発**: ゲーム画面の戻るボタンを「ビビってやめる」に変更。これをクリックすると、即座に終了するのではなく、マスコットによる「最後の煽り」が発生します。
- **引き止めダイアログ**: 煽られた後に「本当に逃げるの？」という確認ダイアログを表示し、プレイヤーのプライドを揺さぶります。

### 2. ド迫力のズームアップ煽り
- **急接近モーション**: ボタンクリック時、マスコットが画面中央に向かって**3.5倍に拡大しながら急接近**してくるアニメーションを実装。
- **強調メッセージ**: 煽りコメントが赤背景のダイナミックな吹き出しで表示され、視覚的な圧迫感を演出します。

### 3. マスコットデザインの更新準備
- ユーザー提供の透過済みマスコット画像への差し替え準備を完了。
- 謎の「火山アイコン」を完全に排除し、新デザインが映えるようコードを整理しました。

## 最終検証結果（Phase 15）
- ✅ **タウント演出**: 「ビビってやめる」ボタンから、期待通りのズームアップ＆煽りが発生することを確認。
- ✅ **画像品質**: `BlendedMascot`（スクリーン合成）を廃止し、透過済み画像をそのまま表示することで、色が薄くなる問題を解消。
- ✅ **BGM完全定着**: `AudioContext`の最適化（AudioFocusの解放）により、画面遷移や効果音再生時にもBGMが一切途切れない「真のシームレス再生」を実現。
- ✅ **恥の記録**: 「ビビって逃げた回数」がローカルに保存され、ランキング画面の「マイサマリー」で赤文字で強調表示されることを実装。
- ✅ **視認性向上**: マスコット巨大化時も、煽り吹き出しが画面内に収まるようレイアウトを分離・調整。
- ✅ **徹底的な煽り**: タイトル画面の難易度選択でも「ビビってやめる」を選択すると、確認ダイアログと共にカウントが増加する仕様を追加。
- ✅ **ボトムナビゲーション導入**: アプリ全体の構成を「ホーム」「ランキング」「プロフィール」「設定」「遊び方」の5タブ切り替え式に刷新。メイン画面(`MainScreen`)を作成し、各画面へのアクセス性を向上。
- ✅ **画面構成の整理**: タイトル画面からボタンを削除し、ホームタブとしてシンプル化。「新しく始める」ボタンのみを残し、直感的なUIに変更。
- ✅ **プロフィールの独立**: 設定画面から「アカウント連携」「ユーザー名変更」機能を切り出し、独立した「プロフィール」タブとして実装。設定画面はゲーム環境設定に特化。
- ✅ **遊び方ガイドの画面化**: ダイアログだった遊び方ガイドを独立したタブ画面化し、いつでもマスコットの煽り解説を読めるように変更。
- ✅ **クリア演出の強化**: ゲームクリア時にマスコットが「悔し涙（win.png）」を流し、「まさかお前ごときが...」と悔しがる演出を追加。オーバーレイメッセージも「クッキーが悔しがっています！」に変更。
- ✅ **クリア演出の強化**: ゲームクリア時にマスコットが「悔し涙（win.png）」を流し、「まさかお前ごときが...」と悔しがる演出を追加。オーバーレイメッセージも「クッキーが悔しがっています！」に変更。
- ✅ **ゲーム画面からの逃亡煽り**: ゲーム中断（逃げる）時、タイトル画面に戻った直後に「逃げた回数が記録されました（笑）」というスナックバーを表示し、追い討ちをかける仕様を追加。
- ✅ **BGM安定化**: Androidのオーディオフォーカス設定を「Gain」に変更し、効果音再生時もBGMが途切れないよう修正。
- ✅ **タイトル刷新**: 「クボゲー Vol.1」を削除し、「おしゃべりクッキーのSUDOKU」を禍々しい赤黒グラデーション＆発光演出でリデザイン。
- ✅ **バージョン表記**: タイトル画面右下に「Ver 1.0.0」を追加。

---
最新の状態（Phase 18+）では、逃げてもクリアしてもユーザーの心を揺さぶる（主に煽るか悔しがる）感情豊かなクッキー体験が実装されています。BGMの途切れもなくなり、没入感が向上しました。🍪😈🔥
